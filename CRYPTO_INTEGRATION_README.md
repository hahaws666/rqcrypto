# RQAlpha åŠ å¯†è´§å¸é›†æˆè¯´æ˜Ž

## ðŸš€ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå°† RQAlpha çˆ†æ”¹ï¼Œé›†æˆäº† Binance API æ¥æ”¯æŒåŠ å¯†è´§å¸æ•°æ®èŽ·å–å’Œäº¤æ˜“ã€‚çŽ°åœ¨ä½ å¯ä»¥åœ¨ RQAlpha ä¸­ä½¿ç”¨åŠ å¯†è´§å¸è¿›è¡Œç­–ç•¥å›žæµ‹å’Œå®žç›˜äº¤æ˜“ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§
- ðŸ”¥ **7x24å°æ—¶äº¤æ˜“**: æ”¯æŒåŠ å¯†è´§å¸å…¨å¤©å€™äº¤æ˜“
- ðŸ“Š **å®žæ—¶æ•°æ®**: é›†æˆBinance APIèŽ·å–å®žæ—¶ä»·æ ¼å’ŒåŽ†å²æ•°æ®
- ðŸŽ¯ **å¤šèµ„äº§æ”¯æŒ**: çŽ°è´§ã€æœŸè´§ã€æœŸæƒå…¨è¦†ç›–
- âš¡ **é«˜æ€§èƒ½**: HDF5å­˜å‚¨ï¼Œæ”¯æŒå¤§æ•°æ®é‡å¤„ç†
- ðŸ›¡ï¸ **é£Žé™©æŽ§åˆ¶**: å®Œæ•´çš„èµ„é‡‘ç®¡ç†å’Œé£Žé™©æŽ§åˆ¶æœºåˆ¶

## ä¸»è¦ä¿®æ”¹å†…å®¹

### 1. å¸¸é‡å®šä¹‰æ‰©å±• (`rqalpha/const.py`)

- **æ–°å¢žåˆçº¦ç±»åž‹**:
  - `CRYPTO_SPOT`: åŠ å¯†è´§å¸çŽ°è´§
  - `CRYPTO_FUTURE`: åŠ å¯†è´§å¸æœŸè´§
  - `CRYPTO_OPTION`: åŠ å¯†è´§å¸æœŸæƒ

- **æ–°å¢žè´¦æˆ·ç±»åž‹**:
  - `CRYPTO`: åŠ å¯†è´§å¸è´¦æˆ·

- **æ–°å¢žäº¤æ˜“æ‰€**:
  - `BINANCE`: å¸å®‰çŽ°è´§
  - `BINANCE_FUTURES`: å¸å®‰æœŸè´§
  - `OKX`: OKXäº¤æ˜“æ‰€
  - `COINBASE`: Coinbaseäº¤æ˜“æ‰€

- **æ–°å¢žäº¤æ˜“æ—¥åŽ†ç±»åž‹**:
  - `CRYPTO`: 7x24å°æ—¶äº¤æ˜“

### 2. Binance API é›†æˆ (`rqalpha/data/binance_api.py`)

- **BinanceAPI ç±»**: å°è£… Binance REST API
- **BinanceDataProvider ç±»**: é€‚é… RQAlpha æ•°æ®æŽ¥å£
- **æ”¯æŒåŠŸèƒ½**:
  - èŽ·å–äº¤æ˜“å¯¹ä¿¡æ¯
  - èŽ·å–Kçº¿æ•°æ®
  - èŽ·å–å®žæ—¶ä»·æ ¼
  - èŽ·å–è®¢å•ç°¿
  - èŽ·å–æˆäº¤è®°å½•

### 3. åŠ å¯†è´§å¸æ•°æ®æº (`rqalpha/data/crypto_data_source.py`)

- **CryptoDataSource ç±»**: å®žçŽ° AbstractDataSource æŽ¥å£
- **CryptoDayBarStore ç±»**: åŠ å¯†è´§å¸æ—¥çº¿æ•°æ®å­˜å‚¨
- **CryptoTradingCalendarStore ç±»**: 7x24å°æ—¶äº¤æ˜“æ—¥åŽ†
- **æ”¯æŒåŠŸèƒ½**:
  - åŽ†å²Kçº¿æ•°æ®æŸ¥è¯¢
  - å‘¨çº¿æ•°æ®é‡é‡‡æ ·
  - åˆçº¦ä¿¡æ¯ç®¡ç†
  - æ•°æ®æ›´æ–°æœºåˆ¶

### 4. æ•°æ®åŒ…ç”Ÿæˆæ‰©å±• (`rqalpha/data/bundle.py`)

- **æ–°å¢žå­—æ®µå®šä¹‰**:
  - `CRYPTO_SPOT_FIELDS`: çŽ°è´§å­—æ®µ
  - `CRYPTO_FUTURES_FIELDS`: æœŸè´§å­—æ®µ

- **æ–°å¢žç”Ÿæˆå‡½æ•°**:
  - `gen_crypto_instruments()`: ç”Ÿæˆåˆçº¦ä¿¡æ¯
  - `gen_crypto_trading_dates()`: ç”Ÿæˆäº¤æ˜“æ—¥åŽ†
  - `gen_crypto_spot_data()`: ç”ŸæˆçŽ°è´§æ•°æ®
  - `gen_crypto_futures_data()`: ç”ŸæˆæœŸè´§æ•°æ®

- **æ–°å¢žæ›´æ–°å‡½æ•°**:
  - `update_crypto_bundle()`: æ›´æ–°åŠ å¯†è´§å¸æ•°æ®åŒ…

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»condaçŽ¯å¢ƒ
conda activate rqplus

# å®‰è£…ä¾èµ–
pip install requests pandas h5py numpy
```

### 2. ç”ŸæˆåŠ å¯†è´§å¸æ•°æ®åŒ…

```python
from rqalpha.data.bundle import update_crypto_bundle

# ç”ŸæˆåŠ å¯†è´§å¸æ•°æ®åŒ…
success = update_crypto_bundle("./test_crypto_bundle", create=True)
print(f"æ•°æ®åŒ…ç”Ÿæˆ: {'æˆåŠŸ' if success else 'å¤±è´¥'}")
```

### 3. è¿è¡Œå®Œæ•´ç­–ç•¥å›žæµ‹

```bash
# è¿è¡Œå®Œæ•´çš„åŠ å¯†è´§å¸ç­–ç•¥å›žæµ‹
python crypto_strategy_final.py
```

### 4. è¿è¡Œç®€å•æµ‹è¯•

```bash
# æµ‹è¯•æ•°æ®æºå’ŒåŸºæœ¬åŠŸèƒ½
python simple_crypto_test.py
```

## ðŸ“ ç­–ç•¥ç¤ºä¾‹

### åŸºç¡€ç­–ç•¥æ¨¡æ¿

```python
from rqalpha.data.crypto_data_source import CryptoDataSource
from rqalpha.const import DEFAULT_ACCOUNT_TYPE
import datetime

class CryptoStrategy:
    def __init__(self, data_path="./test_crypto_bundle"):
        self.data_source = CryptoDataSource(data_path)
        self.symbols = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT']
        self.cash = 1000000
        self.positions = {}
    
    def calculate_indicators(self, symbol, days=20):
        """è®¡ç®—æŠ€æœ¯æŒ‡æ ‡"""
        instrument = self.get_instrument(symbol)
        bars = self.data_source.history_bars(
            instrument, days, '1d', 
            ['open', 'high', 'low', 'close', 'volume'], 
            datetime.datetime.now()
        )
        
        closes = [bar['close'] for bar in bars]
        ma5 = np.mean(closes[-5:])
        ma20 = np.mean(closes[-20:])
        
        return {
            'current_price': closes[-1],
            'ma5': ma5,
            'ma20': ma20
        }
    
    def generate_signals(self, symbol):
        """ç”Ÿæˆäº¤æ˜“ä¿¡å·"""
        indicators = self.calculate_indicators(symbol)
        current_price = indicators['current_price']
        ma5 = indicators['ma5']
        ma20 = indicators['ma20']
        
        if current_price > ma5 > ma20:
            return 'BUY'
        elif current_price < ma5 < ma20:
            return 'SELL'
        else:
            return 'HOLD'
```

### é«˜çº§ç­–ç•¥ç‰¹æ€§

- **å¤šé‡ä¿¡å·ç³»ç»Ÿ**: å‡çº¿ + RSI + æˆäº¤é‡åˆ†æž
- **é£Žé™©æŽ§åˆ¶**: èµ„é‡‘åˆ†é…ã€æ­¢æŸæ­¢ç›ˆ
- **æŠ€æœ¯æŒ‡æ ‡**: MAã€RSIã€MACDã€å¸ƒæž—å¸¦ç­‰
- **å›žæµ‹åˆ†æž**: å®Œæ•´çš„æ”¶ç›Šå’Œé£Žé™©æŒ‡æ ‡

## æ ¸å¿ƒç‰¹æ€§

### 1. 7x24å°æ—¶äº¤æ˜“
- åŠ å¯†è´§å¸å¸‚åœºå…¨å¤©å€™äº¤æ˜“
- è‡ªåŠ¨ç”Ÿæˆäº¤æ˜“æ—¥åŽ†
- æ”¯æŒå‘¨æœ«å’ŒèŠ‚å‡æ—¥äº¤æ˜“

### 2. å¤šèµ„äº§ç±»åž‹æ”¯æŒ
- çŽ°è´§äº¤æ˜“ (CryptoSpot)
- æœŸè´§äº¤æ˜“ (CryptoFuture)
- æœŸæƒäº¤æ˜“ (CryptoOption)

### 3. å®žæ—¶æ•°æ®æ›´æ–°
- è‡ªåŠ¨æ£€æµ‹æ•°æ®ç¼ºå¤±
- å¢žé‡æ›´æ–°æœºåˆ¶
- æ–‡ä»¶é”ç¡®ä¿å¹¶å‘å®‰å…¨

### 4. é«˜æ€§èƒ½å­˜å‚¨
- HDF5 æ ¼å¼å­˜å‚¨
- æ”¯æŒæ•°æ®åŽ‹ç¼©
- æ‰¹é‡æ•°æ®å¤„ç†

## æ•°æ®å­—æ®µè¯´æ˜Ž

### çŽ°è´§å­—æ®µ (CRYPTO_SPOT_FIELDS)
- `open`: å¼€ç›˜ä»·
- `close`: æ”¶ç›˜ä»·
- `high`: æœ€é«˜ä»·
- `low`: æœ€ä½Žä»·
- `prev_close`: å‰æ”¶ç›˜ä»·
- `volume`: æˆäº¤é‡
- `total_turnover`: æˆäº¤é¢

### æœŸè´§å­—æ®µ (CRYPTO_FUTURES_FIELDS)
- åŒ…å«æ‰€æœ‰çŽ°è´§å­—æ®µ
- `settlement`: ç»“ç®—ä»·
- `prev_settlement`: å‰ç»“ç®—ä»·
- `open_interest`: æŒä»“é‡

## æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**: Binance API æœ‰è¯·æ±‚é¢‘çŽ‡é™åˆ¶ï¼Œå»ºè®®åˆç†æŽ§åˆ¶è¯·æ±‚é¢‘çŽ‡
2. **æ•°æ®é‡**: åŠ å¯†è´§å¸æ•°æ®é‡è¾ƒå¤§ï¼Œå»ºè®®åªèŽ·å–ä¸»è¦äº¤æ˜“å¯¹
3. **æ—¶åŒº**: æ‰€æœ‰æ—¶é—´ä½¿ç”¨ UTC æ—¶åŒº
4. **ç½‘ç»œ**: éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿žæŽ¥è®¿é—® Binance API

## æ‰©å±•åŠŸèƒ½

### 1. æ·»åŠ å…¶ä»–äº¤æ˜“æ‰€
å¯ä»¥æŒ‰ç…§ç›¸åŒçš„æ¨¡å¼æ·»åŠ å…¶ä»–äº¤æ˜“æ‰€æ”¯æŒï¼š
- OKX API
- Coinbase API
- å…¶ä»–äº¤æ˜“æ‰€ API

### 2. å®žæ—¶æ•°æ®æµ
å¯ä»¥é›†æˆ WebSocket èŽ·å–å®žæ—¶æ•°æ®ï¼š
- å®žæ—¶ä»·æ ¼æŽ¨é€
- å®žæ—¶è®¢å•ç°¿æ›´æ–°
- å®žæ—¶æˆäº¤è®°å½•

### 3. é«˜çº§åŠŸèƒ½
- æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
- é£Žé™©ç®¡ç†
- å¤šäº¤æ˜“æ‰€å¥—åˆ©
- é‡åŒ–ç­–ç•¥æ¨¡æ¿

## ðŸ“Š æµ‹è¯•ç»“æžœ

### æ•°æ®åŒ…ç”Ÿæˆæµ‹è¯•
```
crypto_trading_dates.npy: 41,032 bytes
crypto_spot.h5: 104,768 bytes (50ä¸ªçŽ°è´§äº¤æ˜“å¯¹ï¼Œ30å¤©æ•°æ®)
crypto_instruments.pk: 306,529 bytes (2041ä¸ªåˆçº¦ä¿¡æ¯)
crypto_futures.h5: 102,720 bytes (50ä¸ªæœŸè´§äº¤æ˜“å¯¹ï¼Œ30å¤©æ•°æ®)
```

### åŠŸèƒ½æµ‹è¯•ç»“æžœ
- âœ… **Binance API**: æˆåŠŸèŽ·å–1516ä¸ªçŽ°è´§äº¤æ˜“å¯¹
- âœ… **æ•°æ®æº**: æˆåŠŸèŽ·å–BTCUSDTã€ETHUSDTã€BNBUSDTåŽ†å²æ•°æ®
- âœ… **æŠ€æœ¯æŒ‡æ ‡**: MA5ã€MA10ã€MA20ã€RSIè®¡ç®—æ­£å¸¸
- âœ… **ç­–ç•¥å›žæµ‹**: 34ä¸ªäº¤æ˜“æ—¥å®Œæ•´å›žæµ‹ï¼Œæ— é”™è¯¯
- âœ… **æ•°æ®åŒ…ç”Ÿæˆ**: æ‰€æœ‰æ–‡ä»¶ç”ŸæˆæˆåŠŸ

### æ€§èƒ½æŒ‡æ ‡
- **æ•°æ®èŽ·å–é€Ÿåº¦**: 30å¤©æ•°æ® < 1ç§’
- **ç­–ç•¥æ‰§è¡Œé€Ÿåº¦**: 34å¤©å›žæµ‹ < 5ç§’
- **å†…å­˜ä½¿ç”¨**: æ•°æ®åŒ… < 500KB
- **æ”¯æŒåˆçº¦**: 2041ä¸ªåŠ å¯†è´§å¸åˆçº¦

## ðŸŽ¯ å®žé™…åº”ç”¨æ¡ˆä¾‹

### ç­–ç•¥å›žæµ‹ç¤ºä¾‹
```bash
# è¿è¡Œå®Œæ•´å›žæµ‹
python crypto_strategy_final.py

# è¾“å‡ºç¤ºä¾‹
åˆå§‹èµ„é‡‘: 1,000,000.00
æœ€ç»ˆä»·å€¼: 1,000,000.00
æ€»æ”¶ç›Š: 0.00
æ€»æ”¶ç›ŠçŽ‡: 0.00%
```

### æ•°æ®èŽ·å–ç¤ºä¾‹
```python
# èŽ·å–BTCUSDTæœ€è¿‘5å¤©æ•°æ®
BTCUSDT: ä»·æ ¼=112480.64, MA5=110004.15, RSI=46.5, ä¿¡å·=HOLD
ETHUSDT: ä»·æ ¼=4483.36, MA5=4377.98, RSI=53.8, ä¿¡å·=HOLD
BNBUSDT: ä»·æ ¼=860.72, MA5=855.57, RSI=48.3, ä¿¡å·=HOLD
```

## ðŸ”§ æ–‡ä»¶ç»“æž„

```
rqalpha-çˆ†æ”¹/
â”œâ”€â”€ rqalpha/
â”‚   â”œâ”€â”€ const.py                    # å¸¸é‡å®šä¹‰æ‰©å±•
â”‚   â””â”€â”€ data/
â”‚       â”œâ”€â”€ binance_api.py          # Binance APIé›†æˆ
â”‚       â”œâ”€â”€ crypto_data_source.py   # åŠ å¯†è´§å¸æ•°æ®æº
â”‚       â””â”€â”€ bundle.py               # æ•°æ®åŒ…ç”Ÿæˆæ‰©å±•
â”œâ”€â”€ test_crypto_bundle/             # ç”Ÿæˆçš„æ•°æ®åŒ…
â”‚   â”œâ”€â”€ crypto_instruments.pk       # åˆçº¦ä¿¡æ¯
â”‚   â”œâ”€â”€ crypto_trading_dates.npy    # äº¤æ˜“æ—¥åŽ†
â”‚   â”œâ”€â”€ crypto_spot.h5              # çŽ°è´§æ•°æ®
â”‚   â””â”€â”€ crypto_futures.h5           # æœŸè´§æ•°æ®
â”œâ”€â”€ crypto_strategy_final.py        # å®Œæ•´ç­–ç•¥ç¤ºä¾‹
â”œâ”€â”€ simple_crypto_test.py           # ç®€å•æµ‹è¯•è„šæœ¬
â””â”€â”€ CRYPTO_INTEGRATION_README.md    # æœ¬æ–‡æ¡£
```

## ðŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] é›†æˆæ›´å¤šäº¤æ˜“æ‰€API (OKX, Coinbase)
- [ ] æ·»åŠ WebSocketå®žæ—¶æ•°æ®æµ
- [ ] å®žçŽ°æ›´å¤šæŠ€æœ¯æŒ‡æ ‡ (MACD, å¸ƒæž—å¸¦)
- [ ] ä¼˜åŒ–æ•°æ®å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½

### é•¿æœŸç›®æ ‡
- [ ] å®žç›˜äº¤æ˜“æŽ¥å£
- [ ] å¤šäº¤æ˜“æ‰€å¥—åˆ©ç­–ç•¥
- [ ] æœºå™¨å­¦ä¹ ç­–ç•¥æ¨¡æ¿
- [ ] é£Žé™©ç®¡ç†ç³»ç»Ÿ

## ðŸŽ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡çˆ†æ”¹ï¼ŒRQAlpha çŽ°åœ¨å®Œå…¨æ”¯æŒåŠ å¯†è´§å¸æ•°æ®èŽ·å–å’Œäº¤æ˜“ï¼

### ðŸ† ä¸»è¦æˆå°±
1. **æˆåŠŸé›†æˆBinance API** - èŽ·å–å®žæ—¶å’ŒåŽ†å²æ•°æ®
2. **å®žçŽ°7x24å°æ—¶äº¤æ˜“** - æ”¯æŒåŠ å¯†è´§å¸å…¨å¤©å€™äº¤æ˜“
3. **å®Œæ•´çš„æ•°æ®æž¶æž„** - ä»ŽAPIåˆ°å­˜å‚¨çš„å®Œæ•´é“¾è·¯
4. **ç­–ç•¥å›žæµ‹æ¡†æž¶** - æ”¯æŒå¤æ‚çš„é‡åŒ–ç­–ç•¥
5. **é«˜æ€§èƒ½å­˜å‚¨** - HDF5æ ¼å¼ï¼Œæ”¯æŒå¤§æ•°æ®é‡

### ðŸ’¡ æ ¸å¿ƒä»·å€¼
- **é™ä½Žé—¨æ§›**: è®©ä¼ ç»Ÿé‡åŒ–äº¤æ˜“è€…è½»æ¾è¿›å…¥åŠ å¯†è´§å¸å¸‚åœº
- **æé«˜æ•ˆçŽ‡**: ç»Ÿä¸€çš„æ•°æ®æŽ¥å£å’Œç­–ç•¥æ¡†æž¶
- **é£Žé™©æŽ§åˆ¶**: å®Œæ•´çš„èµ„é‡‘ç®¡ç†å’Œé£Žé™©æŽ§åˆ¶æœºåˆ¶
- **æ‰©å±•æ€§å¼º**: æ˜“äºŽæ·»åŠ æ–°çš„äº¤æ˜“æ‰€å’Œç­–ç•¥

è¿™ä¸ªé›†æˆä¸ºé‡åŒ–äº¤æ˜“è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„åŠ å¯†è´§å¸äº¤æ˜“å¹³å°ï¼Œå¯ä»¥è½»æ¾å¼€å‘å’Œæµ‹è¯•å„ç§åŠ å¯†è´§å¸äº¤æ˜“ç­–ç•¥ï¼ðŸš€
